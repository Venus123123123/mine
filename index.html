<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Лесенка с минами</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(135deg, #1e1e2f, #121212);
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
}
.wrapper {
  display: flex;
  gap: 20px;
}
.game-area {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 20px;
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  backdrop-filter: blur(10px);
}
.row {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.cell {
  width: 70px;
  height: 70px;
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  transition: transform 0.2s, background 0.3s;
}
.cell:hover {
  transform: scale(1.05);
  background: rgba(255,255,255,0.2);
}
.cell.win {
  background: rgba(0,255,128,0.2);
  box-shadow: 0 0 15px rgba(0,255,128,0.6);
}
.cell.mine {
  background: rgba(255,0,64,0.2);
  box-shadow: 0 0 15px rgba(255,0,64,0.6);
}
/* Взрыв */
.explosion {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,0,64,1) 0%, rgba(255,128,128,0) 70%);
  animation: explode 0.8s forwards;
  z-index: 10;
}
@keyframes explode {
  0% { transform: scale(0.5); opacity: 1; }
  70% { transform: scale(4); opacity: 0.7; }
  100% { transform: scale(6); opacity: 0; }
}
.sidebar {
  width: 260px;
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 16px;
  backdrop-filter: blur(10px);
}
.sidebar h2 {
  margin: 0 0 10px 0;
}
input, select {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border: 2px solid transparent;
  border-radius: 10px;
  font-size: 14px;
  outline: none;
  background: rgba(255,255,255,0.08);
  color: #fff;
  transition: all 0.3s;
}
input:focus, select:focus {
  border: 2px solid;
  border-image-slice: 1;
  border-image-source: linear-gradient(90deg, #ff416c, #ff4b2b);
  box-shadow: 0 0 12px rgba(255,75,43,0.6);
}
/* Анимационные кнопки */
.btn {
  position: relative;
  overflow: hidden;
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(90deg,#ff416c,#ff4b2b);
  color: #fff;
  font-weight: bold;
  font-size: 15px;
  cursor: pointer;
  transition: transform 0.2s;
}
.btn:hover { transform: scale(1.05); }
.btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.3);
  transform: skewX(-20deg);
}
.btn.active::after {
  animation: slide 0.7s forwards;
}
@keyframes slide {
  from { left: -100%; }
  to { left: 100%; }
}
/* Красивый выбор мин */
select {
  appearance: none;
  background: rgba(255,255,255,0.08) url("data:image/svg+xml,%3Csvg fill='white' height='24' width='24' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E") no-repeat right 10px center;
  background-size: 16px;
}
#message { margin-top: 12px; min-height: 20px; }
</style>
</head>
<body>
<div class="wrapper">
  <div class="game-area" id="game"></div>
  <div class="sidebar">
    <h2>Баланс: $<span id="balance">100</span></h2>
    <input type="number" id="bet" placeholder="Ставка" />
    <label>Мины:</label>
    <select id="mines">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
    <button class="btn" id="play">Играть</button>
    <button class="btn" id="cashout" disabled>Забрать</button>
    <input type="text" id="promo" placeholder="Промокод" />
    <button class="btn" id="applyPromo">Активировать</button>
    <div id="message"></div>
  </div>
</div>

<script>
const gameArea = document.getElementById('game');
const balanceEl = document.getElementById('balance');
const betInput = document.getElementById('bet');
const playBtn = document.getElementById('play');
const cashoutBtn = document.getElementById('cashout');
const messageEl = document.getElementById('message');
const minesSelect = document.getElementById('mines');
const promoInput = document.getElementById('promo');
const promoBtn = document.getElementById('applyPromo');

let balance = parseInt(localStorage.getItem('balance')) || 100;
balanceEl.textContent = balance;

let usedPromos = JSON.parse(localStorage.getItem('usedPromos')) || {};
let bet = 0;
let rows = 6;
let cols = 4;
let currentRow = 0;
let gameActive = false;
let minesCount = 1;
let mineMap = [];

const promoCodes = {
  "FREE50": 50,
  "VIP100": 100,
  "MAMEN200": 200
};

function createBoard() {
  gameArea.innerHTML = '';
  for (let r = 0; r < rows; r++) {
    const row = document.createElement('div');
    row.classList.add('row');
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.row = r;
      cell.dataset.col = c;
      row.appendChild(cell);
    }
    gameArea.appendChild(row);
  }
}

function generateMines() {
  mineMap = [];
  for (let r = 0; r < rows; r++) {
    let minePositions = [];
    while (minePositions.length < minesCount) {
      let pos = Math.floor(Math.random() * cols);
      if (!minePositions.includes(pos)) minePositions.push(pos);
    }
    mineMap.push(minePositions);
  }
}

function startGame() {
  animateBtn(playBtn);

  bet = parseInt(betInput.value);
  if (!bet || bet <= 0 || bet > balance) {
    messageEl.textContent = 'Неверная ставка';
    return;
  }
  balance -= bet;
  balanceEl.textContent = balance;
  localStorage.setItem('balance', balance);

  minesCount = parseInt(minesSelect.value);
  currentRow = 0;
  gameActive = true;
  playBtn.disabled = true;
  cashoutBtn.disabled = false;
  messageEl.textContent = '';
  createBoard();
  generateMines();
  activateRow();
}

function activateRow() {
  const row = document.querySelectorAll('.row')[currentRow];
  row.querySelectorAll('.cell').forEach(cell => {
    cell.onclick = () => chooseCell(cell);
  });
}

function chooseCell(cell) {
  if (!gameActive) return;
  const r = parseInt(cell.dataset.row);
  const c = parseInt(cell.dataset.col);

  if (mineMap[r].includes(c)) {
    cell.classList.add('mine');
    showExplosion(cell);
    revealMines(r);
    endGame(false);
  } else {
    cell.classList.add('win');
    currentRow++;
    if (currentRow >= rows) {
      endGame(true);
    } else {
      activateRow();
    }
  }
}

function showExplosion(cell) {
  const explosion = document.createElement('div');
  explosion.classList.add('explosion');
  cell.appendChild(explosion);
  setTimeout(() => explosion.remove(), 800);
}

function revealMines(row) {
  const cells = document.querySelectorAll(`.row:nth-child(${row+1}) .cell`);
  cells.forEach((cell, idx) => {
    if (mineMap[row].includes(idx) && !cell.classList.contains('mine')) {
      cell.classList.add('mine');
    }
  });
}

function endGame(win) {
  gameActive = false;
  playBtn.disabled = false;
  cashoutBtn.disabled = true;
  if (win) {
    let multiplier = 1 + (currentRow * minesCount * 0.5);
    let winAmount = Math.floor(bet * multiplier);
    balance += winAmount;
    messageEl.textContent = `Ты выиграл $${winAmount}`;
  } else {
    messageEl.textContent = 'Проигрыш';
  }
  balanceEl.textContent = balance;
  localStorage.setItem('balance', balance);
}

cashoutBtn.addEventListener('click', () => {
  if (!gameActive) return;
  animateBtn(cashoutBtn);
  let multiplier = 1 + (currentRow * minesCount * 0.5);
  let winAmount = Math.floor(bet * multiplier);
  balance += winAmount;
  messageEl.textContent = `Забрано $${winAmount}`;
  balanceEl.textContent = balance;
  localStorage.setItem('balance', balance);
  gameActive = false;
  playBtn.disabled = false;
  cashoutBtn.disabled = true;
});

playBtn.addEventListener('click', startGame);

promoBtn.addEventListener('click', () => {
  animateBtn(promoBtn);
  const code = promoInput.value.trim().toUpperCase();
  if (promoCodes[code]) {
    if (usedPromos[code]) {
      messageEl.textContent = 'Промокод уже использован';
    } else {
      balance += promoCodes[code];
      usedPromos[code] = true;
      localStorage.setItem('balance', balance);
      localStorage.setItem('usedPromos', JSON.stringify(usedPromos));
      balanceEl.textContent = balance;
      messageEl.textContent = `Промокод ${code} активирован: +$${promoCodes[code]}`;
    }
  } else {
    messageEl.textContent = 'Неверный промокод';
  }
});

function animateBtn(btn) {
  btn.classList.add("active");
  setTimeout(() => btn.classList.remove("active"), 700);
}

createBoard();
</script>
</body>
</html>
